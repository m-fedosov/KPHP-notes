# KParsedown - markdown KPHP parser

  

В качестве проекта я выбрал написание парсера markdown в html, который после можно встроить в качестве фильтра для ktemplate

  

Сам выбор проекта был обусловлен тем, что данное расширение будет полезно сообществу:

- Ни один markdown парсер нельзя легко запустить под kphp

- Парсинг через PHP и KPHP можно сравнить по скорости работы

- Становится полем для новых идей, например можно сделать валидаторы поверх markdown парсера

  

Работая над проектом я столкнулся с рядом проблем:

- **Высокий порог входа в разработку под KPHP**

	- Трудности со сборкой KPHP под разные версии Ubuntu

	- Умение работать с бинарником KPHP2CPP

	- Владение компилятором KPHP - флаги, запуск, вывод в cli и в server, обработка ошибок компиляции.

- **Разработка любого немного серьёзного проекта требует сторонних навыков по разработке**

	- Уметь использовать и создавать свои composer-пакеты, настройка автозагрузчика

	- Работать с PHPUnitTests и Ktest

	- Использование дебаггера

	- Написание правильной документации к проекту

- **Особенности KPHP**

	- Синтаксис PHP поддерживается на уровне 7.4 - 8.0 (частично)

	- Проблемыы описанные в [Typical Usage Issues](https://vkcom.github.io/kphp/kphp-basics/typical-usage-issues.html)

	- Legacy код PHP который невозможно или нежелательно использовать в своих проектах. Например, использование конструкции `use(&$by_reference)`

	- Отсутствие строгой типизации в PHP, что приводит к mixed value

  
  

## Начало работы

В качестве библиотеки для переписывания была выбрана [Parsedown](https://github.com/erusev/parsedown), ключевыми преимуществами которой для меня стали:

- Хороший рейтинг, более 10 000 звёздочек, и более 1000 форков

- Все исходники в одном файле

- Есть готовые тесты PHPUnit

  

В качестве способа разработки, постепенно добавлял функции в проект и проверял компилируются ли они, или нет.

  

## Готовая программа

По ходу процесса переписывания кода под KPHP возникали трудности, описанные выше. Переписанный код компилируется под KPHP без предупреждений.

  

Тесты PHPUnit для проверки правильности markdown проходят

  

Загрузил образ программы в composer-пакет и настроил автозагрузку "psr-0"

  

## Встраивание в KTemplate

Встроил свой фильтр markdown_to_html в ktemplate. Для его использованию достаточно запустить пример из `ktemplate_usage/example.php` в фильтр можно загрузить как файл .txt так и текстовую строку, на выходе будет готовый html файл

  

## Участие в Open-Source разработке

Активно взаимодействовал с сообществом разработчиков. Добавил секцию Discussions в репозитория [VKCOM/KPHP](https://github.com/VKCOM/kphp/discussions)

  

### Pull Request

- https://github.com/VKCOM/kphp/discussions/693

- https://github.com/VKCOM/kphp/issues/703

- https://github.com/quasilyte/KTemplate/issues/1

- https://github.com/VKCOM/kphp/issues/703

  

### Оценки от сообщества

https://github.com/m-fedosov/KParsedown/stargazers

  

## Планы по развитию проекта

- Избавиться от mixed value переписав программу под классы

- Написать ktests для проверки маркдаун

- Сравнить по проиводительности работу PHP парсера vs KPHP парсера без классов vs KPHP парсера с классами