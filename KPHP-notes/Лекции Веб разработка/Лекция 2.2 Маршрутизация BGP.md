BGP - это вообще самый главный протокол маршрутизации, на котором держится интернет. 

Отличное видео с краткой выжимкой по BGP:
<iframe width="560" height="315" src="https://www.youtube.com/embed/EVYagz5ZeiA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Теперь попробую объединить инфу из видео и лекции

**BGP**  - это наш единственный внешний шлюзовой протокол (**EGP**), широко используемый сегодня

На рисунке показан пример топологии BGP.
![[Pasted image 20230103181420.png]]

EBGP - или просто ~~еби джипи~~ BGP это и есть протокол, который позволяет работать интернету. Одна из вещей, которая очень уникальна в протоколе, заключается в том, что он формирует пиринги (*равноправный информационный обмен*) точка-точка с другими спикерами BGP, и вы должны создавать эти пиринги **вручную**. Как ты видишь, он занимается маршрутизацией между автономными системама **AS**. Окей, а что такое AS?


## Автономная система - AS

Во времена, когда интернет был ещё маленький об AS все всё знали, сейчас мы этого уже просто не замечаем, хотя они с нами остались. Автономные системы - сеть из машин, в которой используются свои правила адресации и свои протоколы. Условно, сеть провайдера, университета или дома. Внутри автономной системы есть свой пул IP адресов.

Каждой автономной системе, которая хочет быть доступна публично, присваивается свой номер. И этот номер записывается.

>На начало 2017 года в глобальной таблице маршрутизации представлено более 56 тысяч автономных систем

С 2007 года номер имеет длину 32 бита, что позволило адресовать 2^32 автономных систем (за вычетом некоторых зарезервированных диапазонов), не теряя совместимости с уже имеющимися 16-битными ASN.

Получение номера AS и диапазона IP-адресов:
* Есть много денег - идёшь к RIPE NCC, платишь членских взнос, получаешь пул адресов
* Мало денег - идёшь к перекупам LIR, берёшь в аренду адрес


## Получили адрес для нашей AS, что дальше?

**Нужно настроить BGP**
Разработчики Border Gateway Protocol решили не включать в протокол типы контроля надежности. Они просто полагаются на чудесную надежность коммуникаций TCP. В частности, BGP использует TCP- порт `179`.

Окей, просто пойми, что BGP устанавливает TCP сессию с другими AS
Чтобы TCP соединение случайно не обволилось (*Привет, Цукерберг*) BGP постоянно делает обмен с соседней AS сообщением `KEEP ALIVE`, ну а если что-то нужно обновить, шлёт `UPDATE` 

![[Pasted image 20230103185150.png]]

Ещё что важно понять о BGP, одним из главных атрибутов протокола BGP называется атрибута `AS_PATH`. Это список всех автономных систем (**AS**), которые префикс должен был передать на своем пути, скажем, в вашу автономную систему.

`AS_PATH` - это фактически запись всей информации о пути AS. Путь AS настолько важен для функции BGP, что протокол часто называют протоколом маршрутизации вектора пути. Обратите внимание, что это не протокол вектора расстояния (**Distance Vector**), а вектор пути (**Path Vector**). `AS_PATH` используется не только для определения наилучшего пути к месту назначения (т.е. более короткого пути AS), но и в качестве механизма предотвращения петель.

Выглядит это примерно так:
![[Pasted image 20230103185812.png]]
Есть 2 маршрута ...107.7 и ...112.12 Выбор куда отослать пакет зависит от значения AS_Path (чем меньше значение - тем быстрее)


Очевидно, что при пиринге EBGP, когда префикс передается от одного AS к другому AS, отправляющий AS должен поместить свою автономную систему в путь.

В итоге каждый узел теперь знает где мы находимся.

> Если мы меняем наш DNS (и номер автономной сети соответсвенно), то **все** остальные маршрутизаторы быстро понимают, что мы перестали быть доступны по старому адресу. Мы ждём пока они узнают снова где мы находимся

Как-то так работает интернет :)
![[Pasted image 20230103185609.png]]

Ну и теперь вопрос, а в каком виде нам посылать лучше пакеты ))